<script src="common.js"></script>
<script src="dao.js"></script>
<script>
var send_update = function(users) {
	console.debug("sending update: users = " + JSON.stringify(users));
	chrome.tabs.getSelected(null, function(tab) {
		chrome.tabs.sendRequest(tab.id, {"user_update": users}, function(response) {
		});
	});
}

var do_refresh = function(messageEvent) {
	if (messageEvent.name == "force_refresh") {
		console.debug("forcing a refresh");
		do_update();
	}
}

chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
	console.log("received request: " + request.action);

	if (request.action == "force_refresh") {
		console.debug("forcing a refresh");
		do_update();
	}
});

do_update();
</script>
