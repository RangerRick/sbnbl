<script src="common.js"></script>
<script src="dao.js"></script>
<script>
var send_update = function(users) {
	console.debug("sending update: users = " + JSON.stringify(users));
	safari.application.activeBrowserWindow.activeTab.page.dispatchMessage("user_update", users);
}

var do_refresh = function(messageEvent) {
	if (messageEvent.name == "force_refresh") {
		console.debug("forcing a refresh");
		do_update();
	}
}

safari.application.addEventListener("message", do_refresh, false);

do_update();
</script>
